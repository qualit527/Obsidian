---
date: 2025-08-08
title: Spatial Window Decoding 的窗口大小
tags:
  - insight
---
![[../attachments/Pasted image 20250808164442.png|500]]

类似于时间上的 [[Window Decoding]]，空间上涉及多个逻辑比特 patch 的操作（如远距离或多比特 lattice surgery）也可以被拆分成单位大小的窗口进行解码。如上图，窗口 A（包括缓冲区）先进行解码，提交 commit 区的解码结果，将 commit 区与 buffer 区相交的 syndrome 根据解码情况进行修改（人为增加或删除），再对窗口 B 进行解码。这部分逻辑与时间窗口相同。显然窗口缓冲区大小 $w$ 会影响到解码精度，但是需要分情况具体讨论。

## Experimental Results

### 长边错误率

长边类似于 lattice surgery merge 操作后长方形 patch 的横向逻辑信息，一般相对单个 patch 的短边错误率更低。使用空间窗口的情况下：

![[../attachments/Pasted image 20250808165150.png|600]]
1. 随着缓冲区宽度增加，窗口 A 的“码距”线性增加，故 LER 指数降低
2. 本模型中，全局 patch 的大小也随着窗口增加，因此窗口解码器和全局解码器的相对 LER 与窗口大小无关
3. 与全局解码器精度产生差距的原因是：发生了大于 $(d+w)/2$ 的错误

综上所述，只要 $w>0$，长边都比短边更加安全。影响窗口设计的主要是短边错误率。

### 短边错误率

实验结果为：

![[../attachments/Pasted image 20250808171611.png|600]]

这里有两个有趣的现象：
1. 随着缓冲区宽度的增加，LER 有效较低，==逐渐接近全局解码器==
2. ==在物理错误率较低时，小的缓冲区对 LER 的影响更加剧烈==

为了解释这两个现象，需要分析窗口解码下，短边逻辑错误的来源：

![[../attachments/Pasted image 20250808172219.png|600]]

#### 现象一：LER Gap 随缓冲区大小的下界

短边逻辑错误的发生有三个条件：
1. 错误链的两端分别靠近顶部和底部
2. 错误链有且只有一端在窗口 A 的 commit 区，另一端无法在缓冲区内匹配
3. 错误链匹配的总长度 $\leq$ 错误链长度
三个条件共同导致窗口 B 将另外一个 syndrome 匹配到上/下另一端的边界，导致短边（纵向）逻辑错误。

我们来看第三个条件的满足条件，错误链匹配的总长度由窗口 A 边界匹配长度 + 缓冲区边界匹配长度构成：
- 窗口 A 边界长度：$\max\left( \frac{d-1}{2}+1-l, 0 \right)$
- 缓冲区边界长度：$\max(w+1-l, 0)$
条件 3 可重写为：
$$
\begin{align}
\max\left( \frac{d-1}{2}+1-l, 0 \right) + \max(w+1-l, 0) &\leq l \\ \\
d+3+2w &\leq 6l
\end{align}
$$
比如当 $d=9$，长度为 $\{3,4,5\}$ 的错误就可以导致 $w\leq \{3, 6, 9\}$ 窗口解码器的逻辑错误。而长度为 5 的错误即使是全局解码器也解决不了，因此 $w=d$ 就可以达到 LER 的下界。

#### 现象二：LER Gap 随 PER 的变化

上一小节研究的是逻辑错误发生的条件，类似于 QEC code 的码距，而这一小节研究的是更加定量的逻辑错误率。

> [!NOTE] LER 的计算
> $$
> \begin{align}
> LER &= \sum_{l=l_{min}}^n P(\text{length=l}) \times P(\text{error}\ |\ \text{length=l}) \\
> &= \sum_{l=l_{min}}^n \binom{n}{l} p^l(1-p)^{n-l} \times \frac{N_{fail}(l)}{\binom{n}{l}} \\
> &= \sum_{l=l_{min}}^n N_{fail}(l)\ p^l(1-p)^{n-l}
> \end{align}
> $$
> 其中，$N_{fail}(l)$ 能形成逻辑错误的长度为 $l$ 的错误构型数量。

- 对于全局的最大似然解码器，$P(\text{error}\ |\ \text{length>d})=1$，因此 $LER = \sum_{l>d}^n \binom{n}{l} p^l(1-p)^{n-l}$。
- 对于窗口译码器，当 $l_{min}\leq l \leq d$ 时，只有满足现象一中条件的错误才会引起逻辑错误，因此可以展开为最后的形式。

从形式上看，发生特定长度错误的概率、和逻辑错误构型占比，是 LER 的两个构成部分：
- 当 PER 较小时，发生高阶错误的概率非常低。$l_{min}\leq l \leq d$ 的错误占主导项，$w$ 越小，这种错误越多，导致 gap 较大
- 当 PER 较大时，高阶错误也有一定概率发生。反观 $l_{min}\leq l \leq d$ 的错误需要满足额外条件，满足这些条件且长度较小的错误的构型很少。此时构型很多的高阶错误反而占据主导项，这种错误全局解码器也会发生，因此 gap 较小。

这个逻辑确实比较绕，也是短边错误率现象二反常的原因。
